#ifndef _W32K_DIB_DIB_H
#define _W32K_DIB_DIB_H

typedef struct _BLTINFO
{
   SURFOBJ *DestSurface;
   SURFOBJ *SourceSurface;
   SURFOBJ *PatternSurface;
   XLATEOBJ *XlateSourceToDest;
   XLATEOBJ *XlatePatternToDest;
   RECTL DestRect;
   POINTL SourcePoint;
   BRUSHOBJ *Brush;
   POINTL BrushOrigin;
   ULONG Rop4;
} BLTINFO, *PBLTINFO;

typedef VOID (INTERNAL_CALL *PFN_DIB_PutPixel)(SURFOBJ*,LONG,LONG,ULONG);
typedef ULONG (INTERNAL_CALL *PFN_DIB_GetPixel)(SURFOBJ*,LONG,LONG);
typedef VOID (INTERNAL_CALL *PFN_DIB_HLine)(SURFOBJ*,LONG,LONG,LONG,ULONG);
typedef VOID (INTERNAL_CALL *PFN_DIB_VLine)(SURFOBJ*,LONG,LONG,LONG,ULONG);
typedef BOOLEAN (INTERNAL_CALL *PFN_DIB_BitBlt)(PBLTINFO);
typedef BOOLEAN (INTERNAL_CALL *PFN_DIB_StretchBlt)(SURFOBJ*,SURFOBJ*,RECTL*,RECTL*,POINTL*,POINTL,CLIPOBJ*,XLATEOBJ*,ULONG);
typedef BOOLEAN (INTERNAL_CALL*PFN_DIB_TransparentBlt)(SURFOBJ*,SURFOBJ*,RECTL*,POINTL*,XLATEOBJ*,ULONG);

typedef struct
{
  PFN_DIB_PutPixel       DIB_PutPixel;
  PFN_DIB_GetPixel       DIB_GetPixel;
  PFN_DIB_HLine          DIB_HLine;
  PFN_DIB_VLine          DIB_VLine;
  PFN_DIB_BitBlt         DIB_BitBlt;
  PFN_DIB_BitBlt         DIB_BitBltSrcCopy;
  PFN_DIB_StretchBlt     DIB_StretchBlt;
  PFN_DIB_TransparentBlt DIB_TransparentBlt;
} DIB_FUNCTIONS;

extern DIB_FUNCTIONS DibFunctionsForBitmapFormat[];

VOID INTERNAL_CALL Dummy_PutPixel(SURFOBJ*,LONG,LONG,ULONG);
ULONG INTERNAL_CALL Dummy_GetPixel(SURFOBJ*,LONG,LONG);
VOID INTERNAL_CALL Dummy_HLine(SURFOBJ*,LONG,LONG,LONG,ULONG);
VOID INTERNAL_CALL Dummy_VLine(SURFOBJ*,LONG,LONG,LONG,ULONG);
BOOLEAN INTERNAL_CALL Dummy_BitBlt(PBLTINFO);
BOOLEAN INTERNAL_CALL Dummy_StretchBlt(SURFOBJ*,SURFOBJ*,RECTL*,RECTL*,POINTL*,POINTL,CLIPOBJ*,XLATEOBJ*,ULONG);
BOOLEAN INTERNAL_CALL Dummy_TransparentBlt(SURFOBJ*,SURFOBJ*,RECTL*,POINTL*,XLATEOBJ*,ULONG);

VOID INTERNAL_CALL DIB_1BPP_PutPixel(SURFOBJ*,LONG,LONG,ULONG);
ULONG INTERNAL_CALL DIB_1BPP_GetPixel(SURFOBJ*,LONG,LONG);
VOID INTERNAL_CALL DIB_1BPP_HLine(SURFOBJ*,LONG,LONG,LONG,ULONG);
VOID INTERNAL_CALL DIB_1BPP_VLine(SURFOBJ*,LONG,LONG,LONG,ULONG);
BOOLEAN INTERNAL_CALL DIB_1BPP_BitBlt(PBLTINFO);
BOOLEAN INTERNAL_CALL DIB_1BPP_BitBltSrcCopy(PBLTINFO);
BOOLEAN INTERNAL_CALL DIB_1BPP_StretchBlt(SURFOBJ*,SURFOBJ*,RECTL*,RECTL*,POINTL*,POINTL,CLIPOBJ*,XLATEOBJ*,ULONG);
BOOLEAN INTERNAL_CALL DIB_1BPP_TransparentBlt(SURFOBJ*,SURFOBJ*,RECTL*,POINTL*,XLATEOBJ*,ULONG);

VOID INTERNAL_CALL DIB_4BPP_PutPixel(SURFOBJ*,LONG,LONG,ULONG);
ULONG INTERNAL_CALL DIB_4BPP_GetPixel(SURFOBJ*,LONG,LONG);
VOID INTERNAL_CALL DIB_4BPP_HLine(SURFOBJ*,LONG,LONG,LONG,ULONG);
VOID INTERNAL_CALL DIB_4BPP_VLine(SURFOBJ*,LONG,LONG,LONG,ULONG);
BOOLEAN INTERNAL_CALL DIB_4BPP_BitBlt(PBLTINFO);
BOOLEAN INTERNAL_CALL DIB_4BPP_BitBltSrcCopy(PBLTINFO);
BOOLEAN INTERNAL_CALL DIB_4BPP_StretchBlt(SURFOBJ*,SURFOBJ*,RECTL*,RECTL*,POINTL*,POINTL,CLIPOBJ*,XLATEOBJ*,ULONG);
BOOLEAN INTERNAL_CALL DIB_4BPP_TransparentBlt(SURFOBJ*,SURFOBJ*,RECTL*,POINTL*,XLATEOBJ*,ULONG);

VOID INTERNAL_CALL DIB_8BPP_PutPixel(SURFOBJ*,LONG,LONG,ULONG);
ULONG INTERNAL_CALL DIB_8BPP_GetPixel(SURFOBJ*,LONG,LONG);
VOID INTERNAL_CALL DIB_8BPP_HLine(SURFOBJ*,LONG,LONG,LONG,ULONG);
VOID INTERNAL_CALL DIB_8BPP_VLine(SURFOBJ*,LONG,LONG,LONG,ULONG);
BOOLEAN INTERNAL_CALL DIB_8BPP_BitBlt(PBLTINFO);
BOOLEAN INTERNAL_CALL DIB_8BPP_BitBltSrcCopy(PBLTINFO);
BOOLEAN INTERNAL_CALL DIB_8BPP_StretchBlt(SURFOBJ*,SURFOBJ*,RECTL*,RECTL*,POINTL*,POINTL,CLIPOBJ*,XLATEOBJ*,ULONG);
BOOLEAN INTERNAL_CALL DIB_8BPP_TransparentBlt(SURFOBJ*,SURFOBJ*,RECTL*,POINTL*,XLATEOBJ*,ULONG);

VOID INTERNAL_CALL DIB_16BPP_PutPixel(SURFOBJ*,LONG,LONG,ULONG);
ULONG INTERNAL_CALL DIB_16BPP_GetPixel(SURFOBJ*,LONG,LONG);
VOID INTERNAL_CALL DIB_16BPP_HLine(SURFOBJ*,LONG,LONG,LONG,ULONG);
VOID INTERNAL_CALL DIB_16BPP_VLine(SURFOBJ*,LONG,LONG,LONG,ULONG);
BOOLEAN INTERNAL_CALL DIB_16BPP_BitBlt(PBLTINFO);
BOOLEAN INTERNAL_CALL DIB_16BPP_BitBltSrcCopy(PBLTINFO);
BOOLEAN INTERNAL_CALL DIB_16BPP_StretchBlt(SURFOBJ*,SURFOBJ*,RECTL*,RECTL*,POINTL*,POINTL,CLIPOBJ*,XLATEOBJ*,ULONG);
BOOLEAN INTERNAL_CALL DIB_16BPP_TransparentBlt(SURFOBJ*,SURFOBJ*,RECTL*,POINTL*,XLATEOBJ*,ULONG);

VOID INTERNAL_CALL DIB_24BPP_PutPixel(SURFOBJ*,LONG,LONG,ULONG);
ULONG INTERNAL_CALL DIB_24BPP_GetPixel(SURFOBJ*,LONG,LONG);
VOID INTERNAL_CALL DIB_24BPP_HLine(SURFOBJ*,LONG,LONG,LONG,ULONG);
VOID INTERNAL_CALL DIB_24BPP_VLine(SURFOBJ*,LONG,LONG,LONG,ULONG);
BOOLEAN INTERNAL_CALL DIB_24BPP_BitBlt(PBLTINFO);
BOOLEAN INTERNAL_CALL DIB_24BPP_BitBltSrcCopy(PBLTINFO);
BOOLEAN INTERNAL_CALL DIB_24BPP_StretchBlt(SURFOBJ*,SURFOBJ*,RECTL*,RECTL*,POINTL*,POINTL,CLIPOBJ*,XLATEOBJ*,ULONG);
BOOLEAN INTERNAL_CALL DIB_24BPP_TransparentBlt(SURFOBJ*,SURFOBJ*,RECTL*,POINTL*,XLATEOBJ*,ULONG);

VOID INTERNAL_CALL DIB_32BPP_PutPixel(SURFOBJ*,LONG,LONG,ULONG);
ULONG INTERNAL_CALL DIB_32BPP_GetPixel(SURFOBJ*,LONG,LONG);
VOID INTERNAL_CALL DIB_32BPP_HLine(SURFOBJ*,LONG,LONG,LONG,ULONG);
VOID INTERNAL_CALL DIB_32BPP_VLine(SURFOBJ*,LONG,LONG,LONG,ULONG);
BOOLEAN INTERNAL_CALL DIB_32BPP_BitBlt(PBLTINFO);
BOOLEAN INTERNAL_CALL DIB_32BPP_BitBltSrcCopy(PBLTINFO);
BOOLEAN INTERNAL_CALL DIB_32BPP_StretchBlt(SURFOBJ*,SURFOBJ*,RECTL*,RECTL*,POINTL*,POINTL,CLIPOBJ*,XLATEOBJ*,ULONG);
BOOLEAN INTERNAL_CALL DIB_32BPP_TransparentBlt(SURFOBJ*,SURFOBJ*,RECTL*,POINTL*,XLATEOBJ*,ULONG);

#define ROP_USES_SOURCE(Rop4) (((Rop4 & 0xCC0000) >> 2) != (Rop4 & 0x330000))
#define ROP_USES_PATTERN(Rop4) (((Rop4 & 0xF00000) >> 4) != (Rop4 & 0x0F0000))

extern unsigned char notmask[2];
extern unsigned char altnotmask[2];
#define MASK1BPP(x) (1<<(7-((x)&7)))

ULONG INTERNAL_CALL DIB_DoRop(ULONG Rop, ULONG Dest, ULONG Source, ULONG Pattern);

#define DIB_GetSource(SourceSurf,sx,sy,ColorTranslation)      \
   XLATEOBJ_iXlate(ColorTranslation,                          \
      DibFunctionsForBitmapFormat[SourceSurf->iBitmapFormat]. \
      DIB_GetPixel(SourceSurf, sx, sy))

#define DIB_GetSourceIndex(SourceSurf,sx,sy)                  \
   DibFunctionsForBitmapFormat[SourceSurf->iBitmapFormat].    \
      DIB_GetPixel(SourceSurf, sx, sy)

#endif /* _W32K_DIB_DIB_H */

