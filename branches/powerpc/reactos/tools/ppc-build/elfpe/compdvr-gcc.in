#!/bin/sh

DIR=@PREFIX@
CPREFIX=@CPREFIX@
TARGET=@TARGET@

if [ "x$*" = "x-v" ] ; then
	exec ${CPREFIX}gcc -v
fi

includes="-isystem $DIR/lib/mingw-crt-headers -isystem $DIR/lib/gcc-core-headers"

argstr=""
for arg in $* ; do
	if [ x"$arg" = x-mingw ] ; then
		argstr="$argstr -isystem $DIR/lib/windows-headers"
	else
		argstr="$argstr $arg"
	fi
done

TEMP=`mktemp -d`
export TEMP
if [ ! -d $TEMP ] ; then
    echo "Could not make temp dir $TEMP"
    exit 1
fi
TMP=$TEMP

`dirname $0`/${TARGET}driver-gcc \
	-nostdinc \
	-D__cdecl__= \
	-D__stdcall__= \
	-D__fastcall__= \
	-D__declspec\(x\)= \
	-D__cdecl= \
	-D__stdcall= \
	-D__fastcall= \
	-Dcdecl= \
	-Dstdcall= \
	-Dfastcall= \
	-Ddllimport= \
	-Ddllexport= \
	-Du_short=unsigned\ short \
	-Du_long=unsigned\ long \
	-Du_int=unsigned\ int \
	-Du_char=unsigned\ char \
	-ldscript ${DIR}/lib/ldscript \
	-gcc-name ${CPREFIX}gcc \
	-link-stage-name ${DIR}/bin/${TARGET}ld \
	-mingw-lib-dir $DIR/lib \
	$includes \
	$argstr </dev/null

RES=$?

rm -rf $TEMP
exit $RES
