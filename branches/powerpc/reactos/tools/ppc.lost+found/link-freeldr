#!/bin/sh -v

export PATH=$PATH:/usr/local/pkg/reactos-powerpc/bin
powerpc-unknown-linux-gnu-ld \
	-EL -g -nostartfiles -nostdlib -N -Ttext=0xe17000 \
	-o freeldr.elf \
	obj-ppc/boot/freeldr/freeldr/arch/powerpc/boot.o \
	obj-ppc/boot/freeldr/freeldr/cache/blocklist.o \
	obj-ppc/boot/freeldr/freeldr/cache/cache.o \
	obj-ppc/boot/freeldr/freeldr/comm/rs232.o \
	obj-ppc/boot/freeldr/freeldr/disk/disk.o \
	obj-ppc/boot/freeldr/freeldr/disk/partition.o \
	obj-ppc/boot/freeldr/freeldr/fs/ext2.o \
	obj-ppc/boot/freeldr/freeldr/fs/fat.o \
	obj-ppc/boot/freeldr/freeldr/fs/fs.o \
	obj-ppc/boot/freeldr/freeldr/fs/fsrec.o \
	obj-ppc/boot/freeldr/freeldr/fs/iso.o \
	obj-ppc/boot/freeldr/freeldr/fs/ntfs.o \
	obj-ppc/boot/freeldr/freeldr/inifile/ini_init.o \
	obj-ppc/boot/freeldr/freeldr/inifile/inifile.o \
	obj-ppc/boot/freeldr/freeldr/inifile/parse.o \
	obj-ppc/boot/freeldr/freeldr/math/libgcc2.o \
	obj-ppc/boot/freeldr/freeldr/mm/meminit.o \
	obj-ppc/boot/freeldr/freeldr/mm/mm.o \
	obj-ppc/boot/freeldr/freeldr/reactos/registry.o \
	obj-ppc/boot/freeldr/freeldr/reactos/binhive.o \
	obj-ppc/boot/freeldr/freeldr/reactos/arcname.o \
	obj-ppc/boot/freeldr/freeldr/reactos/reactos.o \
	obj-ppc/boot/freeldr/freeldr/rtl/list.o \
	obj-ppc/boot/freeldr/freeldr/rtl/libsupp.o \
	obj-ppc/boot/freeldr/freeldr/ui/gui.o \
	obj-ppc/boot/freeldr/freeldr/ui/tui.o \
	obj-ppc/boot/freeldr/freeldr/ui/tuimenu.o \
	obj-ppc/boot/freeldr/freeldr/ui/ui.o \
	obj-ppc/boot/freeldr/freeldr/video/bank.o \
	obj-ppc/boot/freeldr/freeldr/video/fade.o \
	obj-ppc/boot/freeldr/freeldr/video/palette.o \
	obj-ppc/boot/freeldr/freeldr/video/pixel.o \
	obj-ppc/boot/freeldr/freeldr/video/video.o \
	obj-ppc/boot/freeldr/freeldr/freeldr.o \
	obj-ppc/boot/freeldr/freeldr/debug.o \
	obj-ppc/boot/freeldr/freeldr/version.o \
	obj-ppc/boot/freeldr/freeldr/cmdline.o \
	obj-ppc/boot/freeldr/freeldr/machine.o \
	obj-ppc/boot/freeldr/freeldr/windows/conversion.o \
	obj-ppc/boot/freeldr/freeldr/windows/peloader.o \
	obj-ppc/boot/freeldr/freeldr/windows/winldr.o \
	obj-ppc/boot/freeldr/freeldr/windows/wlmemory.o \
	obj-ppc/boot/freeldr/freeldr/windows/wlregistry.o \
	obj-ppc/boot/freeldr/freeldr/arch/powerpc/mach.o \
	obj-ppc/boot/freeldr/freeldr/arch/powerpc/ofw.o \
	obj-ppc/boot/freeldr/freeldr/arch/powerpc/mmu.o \
	obj-ppc/boot/freeldr/freeldr/arch/powerpc/mboot.o \
	obj-ppc/boot/freeldr/freeldr/bootmgr.o \
	obj-ppc/boot/freeldr/freeldr/drivemap.o \
	obj-ppc/boot/freeldr/freeldr/miscboot.o \
	obj-ppc/boot/freeldr/freeldr/options.o \
	obj-ppc/boot/freeldr/freeldr/linuxboot.o \
	obj-ppc/boot/freeldr/freeldr/oslist.o \
	obj-ppc/boot/freeldr/freeldr/custom.o \
	obj-ppc/lib/rossym/rossym.a \
	obj-ppc/lib/cmlib/cmlib.a \
	obj-ppc/lib/string/string.a \
	obj-ppc/lib/rtl/rtl.a \
	/usr/local/pkg/reactos-powerpc/lib/libgcc.a
powerpc-unknown-linux-gnu-objcopy -O binary freeldr.elf freeldr.tmp.le
output-ppc/tools/ppc-le2be freeldr.tmp.le freeldr.tmp
(dd if=/dev/zero bs=4k count=16 ; echo 'byebye') >> freeldr.tmp
powerpc-unknown-linux-gnu-objcopy -I binary -B powerpc:common -O elf32-powerpc freeldr.tmp ofwldr.payload
reactos-powerpc-as -mbig -o ofwboot.o boot/freeldr/bootsect/ofwboot.s boot/freeldr/bootsect/ofw_util.s boot/freeldr/bootsect/ofw.s
powerpc-unknown-linux-gnu-ld -EB -Ttext 0xe00000 -Tdata 0xe17000 -e _begin -o ofwldr.x ofwboot.o ofwldr.payload
powerpc-unknown-linux-gnu-objcopy --only-section=.text --only-section=.data --only-section=.bss ofwldr.x ofwldr
