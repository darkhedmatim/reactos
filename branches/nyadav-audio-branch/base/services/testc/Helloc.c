#include <stdlib.h>
#include <stdio.h>
#include <ctype.h>
#include "hello.h"    // header file generated by MIDL compiler

void __cdecl wmain(int argc, char **argv)
{
    RPC_STATUS status;

    unsigned char * pszStringBinding    = NULL;
    unsigned char * pszString           = "hello, world";

    // Use a convenience function to concatenate the elements of
    // the string binding into the proper sequence.
    status = RpcStringBindingCompose(NULL,L"ncacn_np",NULL,L"\\pipe\\audsrv",NULL,&pszStringBinding);
    printf("RpcStringBindingCompose returned 0x%x\n", status);
printf("**%s**\n",pszStringBinding);
    // Set the binding handle that will be used to bind to the server.
    status = RpcBindingFromStringBinding(pszStringBinding,
                                         &hello_v1_0_c_ifspec);
    printf("RpcBindingFromStringBinding returned 0x%x\n", status);


    printf("Calling the remote procedure 'HelloProc'\n");
    printf("Print the string '%s' on the server\n", pszString);

    RpcTryExcept {
		HelloProc(hello_v1_0_c_ifspec,pszString);  // make call with user message
        printf("Calling the remote procedure 'Shutdown'\n");
        Shutdown(hello_v1_0_c_ifspec);  // shut down the server side
    }
    RpcExcept(1) {
        status = RpcExceptionCode();
        printf("Runtime reported exception 0x%lx = %ld\n", status, status);

	  
    }
    RpcEndExcept

    //  The calls to the remote procedures are complete.
    //  Free the string and the binding handle
    status = RpcStringFree(&pszStringBinding);  // remote calls done; unbind
    printf("RpcStringFree returned 0x%x\n", status);

    status = RpcBindingFree(&hello_v1_0_c_ifspec);  // remote calls done; unbind
    printf("RpcBindingFree returned 0x%x\n", status);
    if (status) {
        printf("4Error %d",status);
    }

    exit(0);

}  // end main()

void  __RPC_FAR * __RPC_USER midl_user_allocate(SIZE_T len)
{
    return(malloc(len));
}

void __RPC_USER midl_user_free(void __RPC_FAR * ptr)
{
    free(ptr);
}
